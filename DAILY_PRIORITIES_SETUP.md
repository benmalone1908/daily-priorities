# Daily Priorities Feature - Setup Guide

## Overview

The Daily Priorities feature replaces your manual Google Doc workflow with an integrated task management system. It provides:

- **Manual Task Sections**: Partner Success, Engineering, Launches, Pre-Launch, Ops, Blocked
- **Auto-Generated Sections**: Upcoming Renewals, Pacing Issues, ROAS Alerts
- **Date Navigation**: View and manage priorities for any date
- **Multi-User Support**: Real-time updates via Supabase
- **Historical Archive**: Maintains daily snapshots for tracking

## Setup Instructions

### 1. Apply the Database Migration

Run the SQL migration to create the `daily_priorities` table in your Supabase database:

```bash
# Option 1: Via Supabase Dashboard
# 1. Go to https://supabase.com/dashboard/project/YOUR_PROJECT_ID/sql
# 2. Copy the contents of: supabase/migrations/20251008000000_create_daily_priorities.sql
# 3. Paste and click "Run"

# Option 2: Via Supabase CLI (if you have local Supabase setup)
cd /path/to/campaign-trends
supabase db push
```

### 2. Verify the Migration

Check that the table was created successfully:

```sql
-- Run this in Supabase SQL Editor
SELECT * FROM daily_priorities LIMIT 1;
```

You should see the table structure (it will be empty initially).

### 3. Start the Application

```bash
npm run dev
```

Navigate to the **Daily Priorities** tab in the sidebar.

## Feature Details

### Manual Task Sections

Each section supports:
- ‚úÖ **Add Task**: Click "Add Task" button in any section
- ‚úèÔ∏è **Inline Editing**: Click any field to edit (auto-saves)
- üîó **Ticket Links**: Paste MediaJel task URLs (https://mediajel.io/tasks/details/...)
- üë• **Assignees**: Comma-separated names (e.g., "Ben, Tyler, Hannah")
- ‚òëÔ∏è **Completion**: Check box to mark complete
- üóëÔ∏è **Delete**: Hover over row and click trash icon

### Auto-Generated Sections

These sections refresh automatically when you upload new campaign data:

**Upcoming Renewals**
- Shows campaigns ending in the next 14 days
- Severity levels: High (‚â§7 days), Medium (8-10 days), Low (11-14 days)

**Pacing Issues**
- Campaigns delivering below 85% of target
- Based on last 7 days vs. overall average
- Severity: High (<70%), Medium (70-80%), Low (80-85%)

**ROAS Alerts**
- Campaigns with Return on Ad Spend below 2.0
- Only flags campaigns with >$100 spend
- Severity: High (<1.0), Medium (1.0-1.5), Low (1.5-2.0)

### Date Navigation

- **Calendar Picker**: Click date to jump to any day
- **Previous/Next Buttons**: Navigate day by day
- **Today Button**: Quick return to current date
- **Bold Dates**: Dates with existing priorities show bold in calendar

## Daily Workflow

### Morning Standup

1. Click "Today" button to view current day
2. Review all manual task sections
3. Check auto-generated campaign alerts
4. Assign tasks during standup call
5. Mark urgent items

### Throughout the Day

1. Update task status as work progresses
2. Add new tasks as they arise
3. Mark completed tasks with checkbox
4. Add notes in description fields

### Next Day Preparation

1. Navigate to tomorrow's date
2. System creates new empty slate
3. Previous day's data is preserved (historical archive)
4. Auto-generated sections refresh from latest campaign data

## Database Schema

```sql
daily_priorities (
  id              UUID PRIMARY KEY
  date            DATE NOT NULL
  priority_order  INTEGER NOT NULL
  section         TEXT NOT NULL  -- 'partner_success', 'engineering', etc.
  client_name     TEXT
  ticket_url      TEXT
  description     TEXT
  assignees       TEXT[]
  completed       BOOLEAN DEFAULT false
  completed_at    TIMESTAMPTZ
  created_at      TIMESTAMPTZ
  updated_at      TIMESTAMPTZ
  created_by      TEXT
  updated_by      TEXT
)
```

## Multi-User Support

The feature supports multiple simultaneous users:

- Real-time updates via Supabase subscriptions
- Optimistic UI updates for instant feedback
- Conflict resolution handled automatically
- Row-level security policies allow all authenticated users

## Customization

### Adjust Auto-Generated Thresholds

Edit [useAutoGeneratedPriorities.ts](src/hooks/useAutoGeneratedPriorities.ts):

```typescript
// Change renewal warning window (default: 14 days)
if (daysUntilEnd > 0 && daysUntilEnd <= 14) { ... }

// Change pacing threshold (default: 85%)
if (pacingRate < 85) { ... }

// Change ROAS threshold (default: 2.0)
if (roas < 2.0 && totalSpend > 100) { ... }
```

### Add New Task Sections

Edit [daily-priorities.ts](src/types/daily-priorities.ts):

```typescript
export type PrioritySection =
  | 'partner_success'
  | 'engineering'
  | 'launches'
  | 'pre_launch'
  | 'ops'
  | 'blocked'
  | 'your_new_section';  // Add here

export const SECTION_LABELS: Record<PrioritySection, string> = {
  // ... existing mappings
  your_new_section: 'Your New Section Name'
};

export const SECTION_ORDER: PrioritySection[] = [
  // Add to desired position
  'your_new_section',
  // ... existing sections
];
```

Then update the database constraint:

```sql
ALTER TABLE daily_priorities
DROP CONSTRAINT daily_priorities_section_check;

ALTER TABLE daily_priorities
ADD CONSTRAINT daily_priorities_section_check
CHECK (section IN (
  'partner_success',
  'engineering',
  'launches',
  'pre_launch',
  'ops',
  'blocked',
  'your_new_section'
));
```

## Troubleshooting

### "Cannot read properties of undefined"

**Cause**: Migration not applied
**Solution**: Run the migration SQL in Supabase dashboard

### Auto-generated sections not updating

**Cause**: No campaign data in database
**Solution**: Upload CSV data via main dashboard

### Tasks not saving

**Cause**: Supabase connection issue
**Solution**: Check `.env.local` has correct Supabase credentials

### Calendar not showing priority dates

**Cause**: Query issue or no data
**Solution**: Check browser console for errors

## Migration from Google Doc

To migrate your existing Google Doc priorities:

1. **Manual Entry**: Copy current day's tasks into new system
2. **Or Build Import Tool**: Create one-time script to parse Google Doc and insert via API

Example import script structure:

```typescript
// Import existing tasks
const tasks = [
  { section: 'partner_success', client: 'Client A', description: '...', assignees: ['Ben'] },
  // ... more tasks
];

for (const task of tasks) {
  await supabase.from('daily_priorities').insert({
    date: '2025-10-08',
    section: task.section,
    client_name: task.client,
    description: task.description,
    assignees: task.assignees,
    priority_order: tasks.indexOf(task) + 1
  });
}
```

## Benefits Over Google Doc

‚úÖ **Single Source of Truth**: Integrated with campaign data
‚úÖ **Automatic Alerts**: Renewals, pacing, ROAS auto-generated
‚úÖ **No Copy/Paste**: Each day starts fresh automatically
‚úÖ **Historical Record**: All past days preserved
‚úÖ **Better UX**: Inline editing, quick navigation, responsive design
‚úÖ **Multi-User**: Real-time updates for team collaboration
‚úÖ **Searchable**: Database queries vs manual scrolling

## Support

For issues or questions:
1. Check browser console for errors
2. Verify Supabase connection in Network tab
3. Check migration was applied successfully
4. Review this guide for common solutions
